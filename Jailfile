FROM 12.1-RELEASE
RUN "pkg bootstrap -y && pkg install -y elixir node10 npm-node10 python git"
RUN "pw user add webapp -m"
WORKDIR /usr/home/webapp/
ADD . /usr/home/webapp/
RUN chown -R webapp:webapp .
USER webapp
RUN mix local.hex --force
RUN mix local.rebar --force
RUN mix deps.get
WORKDIR /usr/home/webapp/assets
RUN "npm install && npm rebuild node-sass && npm run deploy"
WORKDIR /usr/home/webapp/
RUN "mix compile && mix phx.digest"
EXPORT
